<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>插件目录</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-50 text-gray-800">
    <header class="bg-blue-600 text-white py-8 shadow-md">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold mb-2">插件目录</h1>
            <p class="text-xl">第三方插件仓库（简化版）</p>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-600 pb-3 border-b border-gray-200">目录</h2>
            <ul class="mt-4 list-disc list-inside">
                <li><a href="#api-docs-section" class="text-blue-600 hover:underline">API文档</a></li>
                <li><a href="#plugin-list-section" class="text-blue-600 hover:underline">插件列表</a></li>
            </ul>
        </div>
        
        <div id="api-docs-section" class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-600 pb-3 border-b border-gray-200">API 文档</h2>
            
            <div class="mt-6">
                <h3 class="text-xl font-semibold text-blue-700 pb-2 border-b border-gray-200">基本信息</h3>
                <p class="mt-3">本API提供对插件目录的访问，允许查询所有插件的元数据。</p>
                <ul class="mt-2 space-y-1">
                    <li class="flex items-center"><i class="fas fa-angle-right text-blue-500 mr-2"></i>请求方式: GET</li>
                    <li class="flex items-center"><i class="fas fa-angle-right text-blue-500 mr-2"></i>基本URL: <code class="bg-gray-100 px-1 py-0.5 rounded">https://looseprince.github.io/Plugin-Catalogue/plugins.json</code></li>
                    <li class="flex items-center"><i class="fas fa-angle-right text-blue-500 mr-2"></i>返回格式: JSON</li>
                </ul>
            </div>

            <div class="mt-6">
                <h3 class="text-xl font-semibold text-blue-700 pb-2 border-b border-gray-200">API端点</h3>
                <div class="mt-3">
                    <h4 class="text-lg font-medium text-blue-700 flex items-center"><i class="fas fa-link mr-2"></i>获取所有插件</h4>
                    <p class="mt-1">返回所有可用插件的信息。</p>
                    <div class="bg-gray-800 text-gray-100 p-4 rounded-md mt-2 overflow-x-auto">
                        <pre><code>GET /plugins.json</code></pre>
                    </div>
                </div>
            </div>

            <div class="mt-6">
                <h3 class="text-xl font-semibold text-blue-700 pb-2 border-b border-gray-200">响应格式</h3>
                <p class="mt-3">API返回一个插件对象数组，每个插件对象包含以下字段：</p>
                <div class="bg-gray-800 text-gray-100 p-4 rounded-md mt-2 overflow-x-auto">
                    <pre><code>{
  "id": "插件唯一标识符",
  "name": "插件名称",
  "version": "当前版本",
  "description": {
    "en_us": "英文描述",
    "zh_cn": "中文描述"
  },
  "dependencies": {}, // 插件依赖
  "labels": [], // 插件标签
  "repository_url": "GitHub仓库URL",
  "update_time": "数据更新时间（格式：YYYY-MM-DD HH:mm:ss）",
  "update_time_timestamp": 1706163361, // 数据更新时间戳（Unix时间戳，单位：秒）
  "latest_version": "最新版本",
  "license": "许可证类型",
  "license_url": "许可证URL",
  "downloads": 下载次数,
  "readme_url": "README文件URL",
  "last_update_time": "最后更新时间（格式：YYYY-MM-DD HH:mm:ss）",
  "last_update_time_timestamp": 1706163361, // 最后更新时间戳（Unix时间戳，单位：秒）
  "authors": [
    {
      "name": "作者名称",
      "link": "作者链接"
    }
  ]
}</code></pre>
                </div>
            </div>

            <div class="mt-6">
                <h3 class="text-xl font-semibold text-blue-700 pb-2 border-b border-gray-200">使用示例</h3>
                <div class="mt-3">
                    <h4 class="text-lg font-medium text-blue-700 flex items-center"><i class="fas fa-code mr-2"></i>使用fetch API获取插件数据</h4>
                    <div class="bg-gray-800 text-gray-100 p-4 rounded-md mt-2 overflow-x-auto">
                        <pre><code>// 使用JavaScript fetch API获取插件数据
fetch('https://looseprince.github.io/Plugin-Catalogue/plugins.json')
  .then(response => response.json())
  .then(plugins => {
    console.log('获取到插件数量:', plugins.length);
    // 处理插件数据
    plugins.forEach(plugin => {
      console.log(`插件名称: ${plugin.name}, 版本: ${plugin.latest_version}`);
    });
  })
  .catch(error => console.error('获取插件数据失败:', error));</code></pre>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="plugin-list-section" class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-600 pb-3 border-b border-gray-200 flex items-center">
                <i class="fas fa-puzzle-piece mr-2"></i>插件列表
                <span class="ml-2 text-sm font-normal text-gray-500">数据更新时间: <span id="update-time" class="font-semibold">2025-01-25 12:56:01.000</span></span>
            </h2>
            
            <div class="mt-4 flex flex-col md:flex-row md:justify-between space-y-4 md:space-y-0 md:space-x-4">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" id="search-input" placeholder="搜索插件..." 
                        class="pl-10 pr-4 py-2 w-full md:w-64 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                    <select id="tag-filter" 
                        class="w-full sm:w-40 border border-gray-300 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">所有标签</option>
                        <!-- 标签选项会动态填充 -->
                    </select>
                    <select id="sort-by" 
                        class="w-full sm:w-40 border border-gray-300 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="name">按名称排序</option>
                        <option value="downloads">按下载量排序</option>
                        <option value="update_time">按更新时间排序</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-6 overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-cube mr-1"></i>名称</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-code-branch mr-1"></i>版本</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-info-circle mr-1"></i>描述</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-user mr-1"></i>作者</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-tags mr-1"></i>标签</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-download mr-1"></i>下载量</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-balance-scale mr-1"></i>许可证</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <span class="flex items-center"><i class="fas fa-clock mr-1"></i>更新时间</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- 插件数据将通过JavaScript动态填充 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>插件目录 &copy; 2025 | 数据每4个小时的45时自动更新</p>
        </div>
    </footer>

    <script>
        // 获取插件数据
        fetch('plugins.json')
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('tbody');
                const updateTime = document.getElementById('update-time');
                const tagFilter = document.getElementById('tag-filter');
                const sortBy = document.getElementById('sort-by');
                const searchInput = document.getElementById('search-input');
                
                // 更新时间显示
                if (data.length > 0) {
                    const updateTime = new Date(data[0].update_time_timestamp * 1000);
                    document.getElementById('update-time').textContent = updateTime.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });
                }
                
                // 收集所有标签
                const allTags = new Set();
                data.forEach(plugin => {
                    if (plugin.labels && Array.isArray(plugin.labels)) {
                        plugin.labels.forEach(tag => allTags.add(tag));
                    }
                });
                
                // 填充标签过滤器
                allTags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag;
                    option.textContent = tag;
                    tagFilter.appendChild(option);
                });
                
                // 渲染插件列表函数
                function renderPlugins(plugins) {
                    tbody.innerHTML = ''; // 清空表格
                    
                    if (plugins.length === 0) {
                        const emptyRow = document.createElement('tr');
                        const emptyCell = document.createElement('td');
                        emptyCell.colSpan = 8;
                        emptyCell.className = 'px-6 py-4 text-center text-gray-500';
                        emptyCell.innerHTML = '<i class="fas fa-search-minus mr-2"></i>没有找到匹配的插件';
                        emptyRow.appendChild(emptyCell);
                        tbody.appendChild(emptyRow);
                        return;
                    }
                    
                    plugins.forEach(plugin => {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-gray-50';
                        
                        // 名称 (带链接)
                        const nameCell = document.createElement('td');
                        nameCell.className = 'px-6 py-4 whitespace-nowrap';
                        const nameLink = document.createElement('a');
                        nameLink.href = plugin.repository_url;
                        nameLink.target = "_blank";
                        nameLink.className = 'text-blue-600 hover:text-blue-800 hover:underline flex items-center';
                        nameLink.innerHTML = `<i class="fab fa-github mr-1"></i>${plugin.name || plugin.id}`;
                        nameCell.appendChild(nameLink);
                        row.appendChild(nameCell);
                        
                        // 版本
                        const versionCell = document.createElement('td');
                        versionCell.className = 'px-6 py-4 whitespace-nowrap';
                        versionCell.innerHTML = `<span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${plugin.latest_version || plugin.version || 'N/A'}</span>`;
                        row.appendChild(versionCell);
                        
                        // 描述
                        const descCell = document.createElement('td');
                        descCell.className = 'px-6 py-4 max-w-xs';
                        const desc = plugin.description?.zh_cn || plugin.description?.en_us || '无描述';
                        descCell.textContent = desc;
                        row.appendChild(descCell);
                        
                        // 作者
                        const authorCell = document.createElement('td');
                        authorCell.className = 'px-6 py-4 whitespace-nowrap';
                        if (plugin.authors && plugin.authors.length > 0) {
                            plugin.authors.forEach((author, index) => {
                                if (index > 0) authorCell.appendChild(document.createTextNode(', '));
                                if (author.link) {
                                    const authorLink = document.createElement('a');
                                    authorLink.href = author.link;
                                    authorLink.target = "_blank";
                                    authorLink.className = 'text-blue-600 hover:text-blue-800 hover:underline';
                                    authorLink.textContent = author.name;
                                    authorCell.appendChild(authorLink);
                                } else {
                                    authorCell.appendChild(document.createTextNode(author.name));
                                }
                            });
                        } else {
                            authorCell.textContent = '未知';
                        }
                        row.appendChild(authorCell);
                        
                        // 标签
                        const tagsCell = document.createElement('td');
                        tagsCell.className = 'px-6 py-4';
                        if (plugin.labels && plugin.labels.length > 0) {
                            const tagsDiv = document.createElement('div');
                            tagsDiv.className = 'flex flex-wrap gap-1';
                            plugin.labels.forEach(tag => {
                                const tagSpan = document.createElement('span');
                                tagSpan.className = 'px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-full';
                                tagSpan.textContent = tag;
                                tagsDiv.appendChild(tagSpan);
                            });
                            tagsCell.appendChild(tagsDiv);
                        } else {
                            tagsCell.textContent = '-';
                        }
                        row.appendChild(tagsCell);
                        
                        // 下载量
                        const downloadsCell = document.createElement('td');
                        downloadsCell.className = 'px-6 py-4 whitespace-nowrap';
                        downloadsCell.innerHTML = `<span class="flex items-center"><i class="fas fa-download mr-1 text-green-500"></i>${plugin.downloads || '0'}</span>`;
                        row.appendChild(downloadsCell);
                        
                        // 许可证
                        const licenseCell = document.createElement('td');
                        licenseCell.className = 'px-6 py-4 whitespace-nowrap';
                        if (plugin.license) {
                            if (plugin.license_url) {
                                const licenseLink = document.createElement('a');
                                licenseLink.href = plugin.license_url;
                                licenseLink.target = "_blank";
                                licenseLink.className = 'text-blue-600 hover:text-blue-800 hover:underline flex items-center';
                                licenseLink.innerHTML = `<i class="fas fa-balance-scale mr-1"></i>${plugin.license}`;
                                licenseCell.appendChild(licenseLink);
                            } else {
                                licenseCell.textContent = plugin.license;
                            }
                        } else {
                            licenseCell.textContent = '未知';
                        }
                        row.appendChild(licenseCell);
                        
                        // 更新时间
                        const updateCell = document.createElement('td');
                        updateCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                        if (plugin.last_update_time_timestamp) {
                            const lastUpdate = new Date(plugin.last_update_time_timestamp * 1000);
                            updateCell.textContent = lastUpdate.toLocaleString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit',
                                second: '2-digit',
                                hour12: false
                            });
                        } else {
                            updateCell.textContent = '未知';
                        }
                        row.appendChild(updateCell);
                        
                        tbody.appendChild(row);
                    });
                }
                
                // 过滤和排序插件
                function filterAndSortPlugins() {
                    const searchTerm = searchInput.value.toLowerCase();
                    const selectedTag = tagFilter.value;
                    const sortOption = sortBy.value;
                    
                    // 过滤
                    let filteredPlugins = data.filter(plugin => {
                        // 搜索名称和描述
                        const nameMatch = (plugin.name || plugin.id).toLowerCase().includes(searchTerm);
                        const descMatch = (plugin.description?.zh_cn || plugin.description?.en_us || '').toLowerCase().includes(searchTerm);
                        const tagMatch = !selectedTag || (plugin.labels && plugin.labels.includes(selectedTag));
                        
                        return (nameMatch || descMatch) && tagMatch;
                    });
                    
                    // 排序
                    filteredPlugins.sort((a, b) => {
                        if (sortOption === 'downloads') {
                            return (b.downloads || 0) - (a.downloads || 0);
                        } else if (sortOption === 'update_time') {
                            return (b.last_update_time_timestamp || 0) - (a.last_update_time_timestamp || 0);
                        } else {
                            // 默认按名称排序
                            const nameA = (a.name || a.id).toLowerCase();
                            const nameB = (b.name || b.id).toLowerCase();
                            return nameA.localeCompare(nameB);
                        }
                    });
                    
                    renderPlugins(filteredPlugins);
                }
                
                // 添加事件监听器
                searchInput.addEventListener('input', filterAndSortPlugins);
                tagFilter.addEventListener('change', filterAndSortPlugins);
                sortBy.addEventListener('change', filterAndSortPlugins);
                
                // 初始渲染
                filterAndSortPlugins();
            })
            .catch(error => {
                console.error('加载插件数据失败:', error);
                const tbody = document.querySelector('tbody');
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 8;
                cell.className = 'px-6 py-4 text-center text-red-500';
                cell.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i>加载插件数据失败: ${error.message}`;
                row.appendChild(cell);
                tbody.appendChild(row);
            });
    </script>
</body>
</html>
